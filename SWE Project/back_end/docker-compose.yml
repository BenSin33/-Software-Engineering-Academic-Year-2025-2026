version: "3.9"

services:
  # ===================== DATABASE =====================
  mysql:
    image: mysql:8.0
    container_name: ssb-mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: ssb_db
      MYSQL_USER: ssb_user
      MYSQL_PASSWORD: ssb_pass
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    networks:
      - ssb-network

  # ===================== API GATEWAY =====================
  api-gateway:
    build: ./API_gateway
    container_name: ssb-api-gateway
    command: npm run dev
    ports:
      - "4000:4000"
    depends_on:
      - mysql
    volumes:
      - ./API_gateway:/app
      - /app/node_modules
    networks:
      - ssb-network

  # ===================== AUTH SERVICE =====================
  auth-service:
    build: ./Services/auth_service
    container_name: ssb-auth
    command: npm run dev
    ports:
      - "4001:4001"
    depends_on:
      - mysql
    volumes:
      - ./Services/auth_service:/app
      - /app/node_modules
    networks:
      - ssb-network

  # ===================== USER SERVICE =====================
  user-service:
    build: ./Services/user_service
    container_name: ssb-user
    command: npm run dev
    ports:
      - "4002:4002"
    depends_on:
      - mysql
    volumes:
      - ./Services/user_service:/app
      - /app/node_modules
    networks:
      - ssb-network

  # ===================== STUDENT SERVICE =====================
  student-service:
    build: ./Services/student_service
    container_name: ssb-student
    command: npm run dev
    ports:
      - "4003:4003"
    depends_on:
      - mysql
    volumes:
      - ./Services/student_service:/app
      - /app/node_modules
    networks:
      - ssb-network

  # ===================== BUS SERVICE =====================
  bus-service:
    build: ./Services/bus_service
    container_name: ssb-bus
    command: npm run dev
    ports:
      - "4004:4004"
    depends_on:
      - mysql
    volumes:
      - ./Services/bus_service:/app
      - /app/node_modules
    networks:
      - ssb-network

  # ===================== ROUTE SERVICE =====================
  route-service:
    build: ./Services/route_service
    container_name: ssb-route
    command: npm run dev
    ports:
      - "4005:4005"
    depends_on:
      - mysql
    volumes:
      - ./Services/route_service:/app
      - /app/node_modules
    networks:
      - ssb-network

  # ===================== TRIP SERVICE =====================
  trip-service:
    build: ./Services/trip_service
    container_name: ssb-trip
    command: npm run dev
    ports:
      - "4006:4006"
    depends_on:
      - mysql
    volumes:
      - ./Services/trip_service:/app
      - /app/node_modules
    networks:
      - ssb-network

  # ===================== LOCATION SERVICE =====================
  location-service:
    build: ./Services/location_service
    container_name: ssb-location
    command: npm run dev
    ports:
      - "4007:4007"
    depends_on:
      - mysql
    volumes:
      - ./Services/location_service:/app
      - /app/node_modules
    networks:
      - ssb-network

  # ===================== INCIDENT SERVICE =====================
  incident-service:
    build: ./Services/incident_service
    container_name: ssb-incident
    command: npm run dev
    ports:
      - "4008:4008"
    depends_on:
      - mysql
    volumes:
      - ./Services/incident_service:/app
      - /app/node_modules
    networks:
      - ssb-network

  # ===================== NOTIFICATION SERVICE =====================
  notification-service:
    build: ./Services/notification_service
    container_name: ssb-notification
    command: npm run dev
    ports:
      - "4009:4009"
    depends_on:
      - mysql
    volumes:
      - ./Services/notification_service:/app
      - /app/node_modules
    networks:
      - ssb-network

  # ===================== MESSAGING SERVICE =====================
  messaging-service:
    build: ./Services/messaging_service
    container_name: ssb-messaging
    command: npm run dev
    ports:
      - "4010:4010"
    depends_on:
      - mysql
    volumes:
      - ./Services/messaging_service:/app
      - /app/node_modules
    networks:
      - ssb-network

  # ===================== LOG SERVICE =====================
  log-service:
    build: ./Services/log_service
    container_name: ssb-log
    command: npm run dev
    ports:
      - "4011:4011"
    depends_on:
      - mysql
    volumes:
      - ./Services/log_service:/app
      - /app/node_modules
    networks:
      - ssb-network

# ===================== VOLUMES =====================
volumes:
  mysql_data:

# ===================== NETWORK =====================
networks:
  ssb-network:
    driver: bridge
